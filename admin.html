<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Dinhata Buzzer Hub</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .admin-container {
            max-width: 1200px;
            margin: 100px auto 50px;
            padding: 20px;
        }

        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
        }

        .admin-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .admin-tab {
            padding: 10px 20px;
            background: #f5f5f5;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 500;
        }

        .admin-tab.active {
            background: #2874f0;
            color: white;
        }

        .admin-section {
            display: none;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .admin-section.active {
            display: block;
        }

        .admin-form {
            max-width: 500px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }

        .form-group textarea {
            height: 80px;
            resize: vertical;
        }

        .admin-btn {
            background: #2874f0;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
        }

        .product-list {
            display: grid;
            gap: 20px;
        }

        .product-item {
            display: flex;
            align-items: center;
            padding: 15px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
        }

        .product-item img {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 5px;
            margin-right: 15px;
        }

        .product-details {
            flex: 1;
        }

        .product-actions {
            display: flex;
            gap: 10px;
        }

        .delete-btn {
            background: #ff4444;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
        }

        .orders-list {
            display: grid;
            gap: 15px;
        }

        .order-item {
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            background: #f9f9f9;
        }

        .order-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .order-status {
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 500;
        }

        .status-pending { background: #fff3cd; color: #856404; }
        .status-confirmed { background: #d1ecf1; color: #0c5460; }
        .status-delivered { background: #d4edda; color: #155724; }

        .password-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }

        .password-box {
            background: white;
            padding: 30px;
            border-radius: 10px;
            width: 90%;
            max-width: 400px;
            text-align: center;
        }

        .password-box input {
            width: 100%;
            padding: 12px;
            margin: 15px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="top-header">
            <div class="logo">
                <i class="fas fa-bolt logo-icon"></i>
                <h1>Dinhata <span>Buzzer Hub</span></h1>
            </div>
            
            <div class="user-actions">
                <div class="action-item" onclick="window.location.href='index.html'">
                    <i class="fas fa-home"></i>
                    <span>Back to Site</span>
                </div>
            </div>
        </div>
        
        <nav>
            <div class="nav-links">
                <a href="index.html"><i class="fas fa-home"></i> Home</a>
                <a href="products.html"><i class="fas fa-box"></i> Products</a>
                <a href="admin.html" class="active"><i class="fas fa-user-cog"></i> Admin</a>
            </div>
        </nav>
    </header>

    <!-- Password Modal -->
    <div id="passwordModal" class="password-modal" style="display: flex;">
        <div class="password-box">
            <h2 style="color: #2874f0; margin-bottom: 20px;">Admin Login</h2>
            <p>Enter admin password to continue</p>
            
            <input type="password" id="adminPassword" placeholder="Enter Password" autocomplete="off">
            <div style="color: #ff4444; margin: 10px 0; display: none;" id="passwordError">Incorrect password!</div>
            
            <button class="admin-btn" onclick="checkPassword()" style="width: 100%;">Login</button>
            <button onclick="window.location.href='index.html'" style="width: 100%; margin-top: 10px; background: #666; color: white; border: none; padding: 10px; border-radius: 5px; cursor: pointer;">Back to Home</button>
            
            <p style="margin-top: 20px; font-size: 12px; color: #888;">
                Default password: admin123
            </p>
        </div>
    </div>

    <!-- Admin Content -->
    <div class="admin-container" id="adminContent" style="display: none;">
        <div class="admin-header">
            <h2>Admin Panel</h2>
            <button class="admin-btn" onclick="logoutAdmin()">Logout</button>
        </div>

        <div class="admin-tabs">
            <button class="admin-tab active" onclick="showTab('products')">Products</button>
            <button class="admin-tab" onclick="showTab('orders')">Orders</button>
            <button class="admin-tab" onclick="showTab('addProduct')">Add Product</button>
            <button class="admin-tab" onclick="showTab('telegram')">Telegram</button>
        </div>

        <!-- Products Tab -->
        <div id="products" class="admin-section active">
            <h3>Manage Products</h3>
            <div class="product-list" id="adminProductList">
                <!-- Products will load here -->
            </div>
        </div>

        <!-- Orders Tab -->
        <div id="orders" class="admin-section">
            <h3>Recent Orders</h3>
            <div class="orders-list" id="ordersList">
                <!-- Orders will load here -->
            </div>
        </div>

        <!-- Add Product Tab -->
        <div id="addProduct" class="admin-section">
            <h3>Add New Product</h3>
            <form class="admin-form" id="addProductForm">
                <div class="form-group">
                    <label for="productName">Product Name</label>
                    <input type="text" id="productName" required>
                </div>
                
                <div class="form-group">
                    <label for="productPrice">Price (‚Çπ)</label>
                    <input type="number" id="productPrice" required>
                </div>
                
                <div class="form-group">
                    <label for="productOriginalPrice">Original Price (‚Çπ)</label>
                    <input type="number" id="productOriginalPrice">
                </div>
                
                <div class="form-group">
                    <label for="productImage">Image URL</label>
                    <input type="url" id="productImage" required>
                </div>
                
                <div class="form-group">
                    <label for="productCategory">Category</label>
                    <select id="productCategory" required>
                        <option value="">Select Category</option>
                        <option value="electronics">Electronics</option>
                        <option value="fashion">Fashion</option>
                        <option value="home">Home & Kitchen</option>
                        <option value="grocery">Grocery</option>
                        <option value="beauty">Beauty</option>
                        <option value="sports">Sports</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="productRating">Rating</label>
                    <input type="number" id="productRating" min="1" max="5" step="0.1" value="4.0">
                </div>
                
                <button type="submit" class="admin-btn">Add Product</button>
            </form>
        </div>

        <!-- Telegram Tab -->
        <div id="telegram" class="admin-section">
            <h3>Telegram Configuration</h3>
            <div class="admin-form">
                <div class="form-group">
                    <label for="telegramToken">Bot Token</label>
                    <input type="text" id="telegramToken" value="8589527391:AAEF3bCeKx0J-y9dc0KHeJCOolzHLJjYVo4" readonly>
                </div>
                
                <div class="form-group">
                    <label for="telegramChatId">Chat ID</label>
                    <input type="text" id="telegramChatId" value="7681046220" readonly>
                </div>
                
                <div class="form-group">
                    <label>Status</label>
                    <div style="padding: 10px; background: #d4edda; color: #155724; border-radius: 5px;">
                        <i class="fas fa-check-circle"></i> Telegram Bot Connected Successfully
                    </div>
                </div>
                
                <button class="admin-btn" onclick="testTelegram()">
                    <i class="fas fa-paper-plane"></i> Test Telegram Notification
                </button>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
    <script>
        const ADMIN_PASSWORD = "admin123";
        
        function checkPassword() {
            const input = document.getElementById('adminPassword').value;
            const error = document.getElementById('passwordError');
            
            if (input === ADMIN_PASSWORD) {
                document.getElementById('passwordModal').style.display = 'none';
                document.getElementById('adminContent').style.display = 'block';
                loadAdminProducts();
                loadOrders();
            } else {
                error.style.display = 'block';
                document.getElementById('adminPassword').value = '';
            }
        }
        
        function logoutAdmin() {
            if (confirm('Are you sure you want to logout?')) {
                document.getElementById('adminContent').style.display = 'none';
                document.getElementById('passwordModal').style.display = 'flex';
                document.getElementById('adminPassword').value = '';
                document.getElementById('passwordError').style.display = 'none';
            }
        }
        
        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.admin-section').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active class from all tab buttons
            document.querySelectorAll('.admin-tab').forEach(button => {
                button.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            
            // Add active class to clicked button
            event.target.classList.add('active');
        }
        
        function loadAdminProducts() {
            const products = getProducts();
            const container = document.getElementById('adminProductList');
            
            if (products.length === 0) {
                container.innerHTML = '<p>No products found.</p>';
                return;
            }
            
            container.innerHTML = products.map(product => `
                <div class="product-item">
                    <img src="${product.img}" alt="${product.name}">
                    <div class="product-details">
                        <h4>${product.name}</h4>
                        <p>‚Çπ${product.price} | ${product.category} | Rating: ${product.rating || '4.0'}</p>
                    </div>
                    <div class="product-actions">
                        <button class="delete-btn" onclick="deleteProduct(${product.id})">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </div>
                </div>
            `).join('');
        }
        
        function loadOrders() {
            const container = document.getElementById('ordersList');
            let lastOrder = null;
            
            try {
                lastOrder = JSON.parse(localStorage.getItem('dinhata_last_order'));
            } catch (e) {
                lastOrder = null;
            }
            
            if (!lastOrder) {
                container.innerHTML = '<p>No orders found.</p>';
                return;
            }
            
            container.innerHTML = `
                <div class="order-item">
                    <div class="order-header">
                        <strong>Order ID: ${lastOrder.id}</strong>
                        <span class="order-status status-pending">Pending</span>
                    </div>
                    <p><strong>Customer:</strong> ${lastOrder.name} (${lastOrder.phone})</p>
                    <p><strong>Address:</strong> ${lastOrder.address}</p>
                    <p><strong>Amount:</strong> ‚Çπ${lastOrder.total}</p>
                    <p><strong>Date:</strong> ${lastOrder.date}</p>
                    <div style="margin-top: 10px;">
                        <button class="admin-btn" style="padding: 5px 10px; font-size: 12px;" onclick="updateOrderStatus('${lastOrder.id}', 'confirmed')">Confirm Order</button>
                        <button class="delete-btn" style="padding: 5px 10px; font-size: 12px;">Cancel</button>
                    </div>
                </div>
            `;
        }
        
        function deleteProduct(id) {
            if (!confirm('Are you sure you want to delete this product?')) return;
            
            let products = getProducts();
            products = products.filter(p => p.id !== id);
            saveProducts(products);
            loadAdminProducts();
            alert('Product deleted successfully!');
        }

        async function testTelegram() {
            const testOrder = {
                id: 'TEST' + Date.now(),
                name: 'Test Customer',
                phone: '9876543210',
                address: 'Test Address, Dinhata',
                pincode: '736135',
                items: [{name: 'Test Product', price: 100}],
                subtotal: 100,
                delivery: 40,
                total: 140,
                date: new Date().toLocaleString('en-IN')
            };

            try {
                const result = await sendToTelegram(testOrder);
                if (result) {
                    alert('‚úÖ Test notification sent successfully to Telegram!');
                } else {
                    alert('‚ùå Failed to send test notification');
                }
            } catch (error) {
                alert('‚ùå Error sending test notification');
            }
        }

        async function updateOrderStatus(orderId, status) {
            // Telegram configuration
            const BOT_TOKEN = "8589527391:AAEF3bCeKx0J-y9dc0KHeJCOolzHLJjYVo4";
            const CHAT_ID = "7681046220";

            const message = `
üì¶ <b>Order Status Update</b>
Order ID: ${orderId}
Status: ${status.toUpperCase()}
Time: ${new Date().toLocaleString('en-IN')}
            `;

            try {
                const response = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
                    method: "POST",
                    headers: {"Content-Type": "application/json"},
                    body: JSON.stringify({
                        chat_id: CHAT_ID,
                        text: message,
                        parse_mode: "HTML"
                    })
                });

                if (response.ok) {
                    alert('Status updated and notification sent!');
                }
            } catch (error) {
                console.error('Error sending status update:', error);
            }
        }
        
        // Add product form handler
        document.getElementById('addProductForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const newProduct = {
                id: Date.now(),
                name: document.getElementById('productName').value,
                price: parseInt(document.getElementById('productPrice').value),
                originalPrice: document.getElementById('productOriginalPrice').value ? 
                    parseInt(document.getElementById('productOriginalPrice').value) : null,
                img: document.getElementById('productImage').value,
                category: document.getElementById('productCategory').value,
                rating: parseFloat(document.getElementById('productRating').value) || 4.0,
                discount: document.getElementById('productOriginalPrice').value ? 
                    Math.round((1 - parseInt(document.getElementById('productPrice').value) / 
                    parseInt(document.getElementById('productOriginalPrice').value)) * 100) : null
            };
            
            const products = getProducts();
            products.push(newProduct);
            saveProducts(products);
            
            alert('Product added successfully!');
            this.reset();
            showTab('products');
            loadAdminProducts();
        });
        
        // Allow Enter key in password field
        document.getElementById('adminPassword').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                checkPassword();
            }
        });
    </script>

    <!-- Secret Admin Gesture System for Admin Page -->
    <script>
        // Admin page specific gestures
        let adminGestureState = {
            tapCount: 0,
            lastTap: 0
        };

        // Triple tap title to logout
        document.addEventListener('click', (e) => {
            if (e.target.closest('.logo') || e.target.closest('.admin-header h2')) {
                const now = Date.now();
                if (now - adminGestureState.lastTap < 500) {
                    adminGestureState.tapCount++;
                } else {
                    adminGestureState.tapCount = 1;
                }
                adminGestureState.lastTap = now;

                if (adminGestureState.tapCount >= 3) {
                    adminGestureState.tapCount = 0;
                    if (confirm('Quick logout?')) {
                        logoutAdmin();
                    }
                }
            }
        });

        // Swipe down with three fingers to refresh orders
        let adminGestureStartY = null;

        document.addEventListener('touchstart', (e) => {
            if (e.touches.length === 3) {
                adminGestureStartY = e.touches[0].clientY;
            }
        });

        document.addEventListener('touchmove', (e) => {
            if (e.touches.length === 3 && adminGestureStartY !== null) {
                const currentY = e.touches[0].clientY;
                const diff = currentY - adminGestureStartY;
                
                if (diff > 100) { // Swiped down more than 100px
                    loadOrders();
                    adminGestureStartY = null;
                    
                    // Show refresh feedback
                    const feedback = document.createElement('div');
                    feedback.style.cssText = `
                        position: fixed;
                        top: 50%;
                        left: 50%;
                        transform: translate(-50%, -50%);
                        background: #2874f0;
                        color: white;
                        padding: 10px 20px;
                        border-radius: 20px;
                        z-index: 10000;
                    `;
                    feedback.textContent = 'üîÑ Orders Refreshed';
                    document.body.appendChild(feedback);
                    
                    setTimeout(() => feedback.remove(), 1000);
                }
            }
        });

        // Secret code for admin: Draw a circle on the screen
        let circlePoints = [];
        let circleTimer;

        document.addEventListener('mousemove', (e) => {
            if (e.buttons === 1) { // Left mouse button pressed
                circlePoints.push({x: e.clientX, y: e.clientY});
                
                clearTimeout(circleTimer);
                circleTimer = setTimeout(() => {
                    if (circlePoints.length > 20) {
                        checkCircleGesture();
                    }
                    circlePoints = [];
                }, 1000);
            }
        });

        function checkCircleGesture() {
            // Simple circle detection - check if points form a circular pattern
            const centerX = circlePoints.reduce((sum, p) => sum + p.x, 0) / circlePoints.length;
            const centerY = circlePoints.reduce((sum, p) => sum + p.y, 0) / circlePoints.length;
            
            const distances = circlePoints.map(p => 
                Math.sqrt(Math.pow(p.x - centerX, 2) + Math.pow(p.y - centerY, 2))
            );
            
            const avgDistance = distances.reduce((sum, d) => sum + d, 0) / distances.length;
            const variance = distances.reduce((sum, d) => sum + Math.pow(d - avgDistance, 2), 0) / distances.length;
            
            // If points are roughly equally distant from center (low variance), it's a circle
            if (variance < 10000) { // Adjust threshold as needed
                console.log('Circle gesture detected! Opening advanced settings...');
                alert('üéØ Advanced Admin Features Unlocked!');
            }
        }

        console.log('üîê Admin Page Gestures Loaded');
        console.log('‚Ä¢ Triple tap logo for quick logout');
        console.log('‚Ä¢ Three-finger swipe down to refresh orders');
        console.log('‚Ä¢ Draw a circle for advanced features');
    </script>
</body>
</html>
